---
title: "Tributary Nitrogen Concentrations"
author: "Curtis C. Bohlen, Casco Bay Estuary Partnership."
date: "04/22/2021"
output:
  github_document:
    toc: true
    fig_width: 5
    fig_height: 4
---

<img
    src="https://www.cascobayestuary.org/wp-content/uploads/2014/04/logo_sm.jpg"
    style="position:absolute;top:10px;right:50px;" />

```{r setup, include=FALSE}
knitr::opts_chunk$set(fig.align = 'center',
                      fig.width = 5, fig.height = 4,
                      collapse = TRUE, comment = "#>")
```

# Install Libraries
```{r libraries}
library(readxl)
library(tidyverse)

library(CBEPgraphics)
load_cbep_fonts()
theme_set(theme_cbep())
```

# Read Data
```{r folder_refs}
sibfldnm <- 'Derived_Data'
parent <- dirname(getwd())
sibling <- paste(parent,sibfldnm, sep = '/')
fn <- 'summary_tables_from_gray_2019.xlsx'

dir.create(file.path(getwd(), 'figures'), showWarnings = FALSE)
```

```{r load_dat}
the_data <- read_excel(file.path(sibling, fn), 
    sheet = "Table 3", col_types = c("text", 
        "numeric", "numeric", "numeric", 
        "skip")) %>%
  rename(Tributary = River) %>%
    mutate(Tributary = factor(Tributary, levels = c('Capisic', 'Royal', 'Presumpscot', "Other")))
```


```{r, fig.width = 2.85, fig.height = 4}

total = sum(the_data$`Annual Load`)

plt <- ggplot(the_data, aes(1, `Annual Load`, fill = Tributary)) +
  geom_col() +
  
  ylab('Total Nitrogen\n(Metric Tons per Year)')  +
  xlab('') +
  
  scale_fill_manual(values = cbep_colors()[2:6], name = '') +
  theme_cbep(base_size = 12) +
  theme(axis.text.x= element_blank(),
        axis.ticks.x = element_blank(),
        legend.key.size = unit(0.2, 'in'),
        legend.text = element_text(size = 9)) +
  ylim(0, 500) +
  annotate('text', x = 1, y = 1.04 * total, 
           label = paste(round(total), 'MT'), 
           size = 3)
plt

ggsave('figures/annual_tn_loads_tributaries.pdf', 
       device = cairo_pdf, width = 2.85, height = 4)
```

